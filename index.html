<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>부동산 자산 디지털화 체험 (3단계)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #050816;
      color: #f5f5f5;
      line-height: 1.5;
    }
    .page {
      max-width: 1080px;
      margin: 20px auto 60px auto;
      padding: 0 16px;
    }
    .banner {
      background: linear-gradient(135deg, #1555ff, #26a5ff);
      border-radius: 14px;
      padding: 18px 20px 14px 20px;
      margin-bottom: 16px;
    }
    .banner h1 {
      font-size: 22px;
      margin-bottom: 4px;
    }
    .banner p {
      font-size: 13px;
      opacity: 0.9;
    }
    .steps-nav {
      display: flex;
      gap: 8px;
      margin: 10px 0 18px 0;
      flex-wrap: wrap;
    }
    .steps-nav button {
      flex: 1 1 130px;
      border: 1px solid #2c3f80;
      background: #0c1020;
      color: #f5f5f5;
      padding: 10px 8px;
      border-radius: 999px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.15s ease;
    }
    .steps-nav button.active {
      background: #17b6ff;
      border-color: #17b6ff;
      color: #051018;
      font-weight: 600;
    }
    .card {
      background: #0c1020;
      border-radius: 14px;
      padding: 18px 20px 22px 20px;
      box-shadow: 0 0 0 1px #1a2545;
    }
    .step-title {
      font-size: 18px;
      margin-bottom: 10px;
    }
    .step-sub {
      font-size: 13px;
      opacity: 0.9;
      margin-bottom: 14px;
    }
    .section {
      display: none;
    }
    .section.active {
      display: block;
    }

    h2 { font-size: 18px; margin-bottom: 10px; }
    h3 { font-size: 15px; margin: 12px 0 6px 0; }

    ul, ol { margin-left: 18px; margin-bottom: 8px; }
    li { margin-bottom: 3px; font-size: 13px; }

    .tag {
      display: inline-block;
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #2a3d70;
      margin-right: 6px;
      margin-bottom: 4px;
      opacity: 0.9;
    }

    .info-box {
      border-radius: 10px;
      border: 1px dashed #394b80;
      padding: 10px 12px;
      font-size: 12px;
      margin: 10px 0;
      background: rgba(10, 18, 40, 0.9);
    }

    .form-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
    }
    .form-field {
      flex: 1 1 220px;
      min-width: 200px;
    }
    .form-field label {
      display: block;
      font-size: 12px;
      margin-bottom: 4px;
      opacity: 0.9;
    }
    .form-field input,
    .form-field textarea,
    .form-field select {
      width: 100%;
      padding: 7px 8px;
      border-radius: 8px;
      border: 1px solid #2b395c;
      background: #050816;
      color: #f5f5f5;
      font-size: 13px;
    }
    textarea { resize: vertical; min-height: 60px; }

    .btn-row {
      margin-top: 6px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    button.primary,
    button.secondary,
    button.danger {
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 13px;
      border: none;
      cursor: pointer;
      transition: all 0.15s ease;
    }
    button.primary {
      background: #17b6ff;
      color: #051018;
      font-weight: 600;
    }
    button.primary:hover { filter: brightness(1.05); }
    button.secondary {
      background: #151a2e;
      color: #f5f5f5;
      border: 1px solid #2c3f80;
    }
    button.secondary:hover { background: #1e2440; }
    button.danger {
      background: #ff3b4d;
      color: #fff;
    }
    button.danger:hover { filter: brightness(1.08); }

    .prop-summary {
      margin-top: 10px;
      padding-top: 8px;
      border-top: 1px dashed #2b395c;
      font-size: 12px;
    }

    .chain-summary {
      font-size: 12px;
      margin-bottom: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
      margin-top: 6px;
    }
    th, td {
      border: 1px solid #273357;
      padding: 4px 5px;
      text-align: left;
      vertical-align: top;
    }
    th {
      background: #161d35;
      font-weight: 600;
    }
    tbody tr:nth-child(even) { background: #0e1322; }

    .hash {
      font-family: "SF Mono", Menlo, Consolas, monospace;
      font-size: 10px;
      opacity: 0.9;
      word-break: break-all;
    }
    .pill {
      display: inline-block;
      font-size: 10px;
      padding: 1px 6px;
      border-radius: 999px;
      background: #1a8545;
      margin-left: 4px;
    }

    .small {
      font-size: 11px;
      opacity: 0.9;
    }

    @media (max-width: 600px) {
      .banner h1 { font-size: 18px; }
      .card { padding: 14px 12px 18px 12px; }
      table { font-size: 10px; }
      th, td { padding: 3px 4px; }
    }
  </style>
</head>
<body>
<div class="page">
  <div class="banner">
    <h1>부동산 자산 디지털화 체험 (3단계)</h1>
    <p>부동산 정보를 토큰·블록체인 개념으로 기록해 보는 연습용 사이트입니다.
      <strong>실제 투자·거래 서비스가 아니며, 모든 데이터는 이 브라우저에만 저장됩니다.</strong>
    </p>
  </div>

  <div class="steps-nav">
    <button data-step="1" class="active">1단계 : 개념 설명</button>
    <button data-step="2">2단계 : 부동산 정보 입력</button>
    <button data-step="3">3단계 : 블록체인 체험</button>
  </div>

  <div class="card">
    <!-- 1단계: 설명 -->
    <section id="step1" class="section active">
      <h2 class="step-title">1단계. 개념 설명</h2>
      <p class="step-sub">“부동산을 토큰으로 쪼개서, 거래 이력을 블록체인처럼 이어 붙이면 어떤 느낌일까?” 를 체험하는 단계입니다.</p>

      <div class="info-box">
        <div class="tag">연습용</div>
        <div class="tag">실제 코인·투자 아님</div>
        <div class="tag">브라우저(LocalStorage)에만 저장</div>
      </div>

      <h3>① 이 사이트에서 하는 일</h3>
      <ul>
        <li>부동산 1개(예: 오피스텔 1채)를 가상의 <strong>디지털 자산(토큰)</strong>으로 상상합니다.</li>
        <li>이 자산을 여러 개의 <strong>토큰 단위</strong>로 나누어 본다고 가정합니다. (예: 10,000개)</li>
        <li>임대·매매 등 거래가 발생할 때마다, <strong>블록(Block)</strong>으로 기록을 남깁니다.</li>
        <li>각 블록은 이전 블록의 해시를 포함하여 <strong>체인(Chain) 구조</strong>가 됩니다.</li>
      </ul>

      <h3>② 간단한 구조</h3>
      <ul>
        <li>부동산 기본 정보 → 2단계에서 입력</li>
        <li>거래(예: “101동 1001호 보증금 1,000만 원 인상”) → 3단계에서 블록으로 기록</li>
        <li>각 블록에는 <strong>시간, 제목, 참여자, 설명, 금액, 이전 해시, 현재 해시</strong>가 들어갑니다.</li>
      </ul>

      <h3>③ 실제 서비스로 확장할 때 상상해 볼 수 있는 것</h3>
      <ul>
        <li>토큰 수량에 따라 소유·수익 분배 구조 설계</li>
        <li>임대료 입금 내역을 자동으로 블록 체인에 기록</li>
        <li>투자자별 지분 비율·수익률 대시보드</li>
      </ul>

      <p class="small" style="margin-top:10px;">
        → 이제 아래 탭에서 <strong>2단계 “부동산 정보 입력”</strong>을 눌러 실제로 값을 넣어 보세요.
      </p>
    </section>

    <!-- 2단계: 부동산 정보 입력 -->
    <section id="step2" class="section">
      <h2 class="step-title">2단계. 부동산 정보 입력</h2>
      <p class="step-sub">기준이 되는 부동산 1개를 설정합니다. 이 정보가 3단계 블록체인 기록의 “기본 배경”이 됩니다.</p>

      <form id="property-form" onsubmit="return false;">
        <div class="form-grid">
          <div class="form-field">
            <label for="prop-name">부동산 이름 / 별칭</label>
            <input id="prop-name" placeholder="예) 강남 오피스텔 101동" />
          </div>
          <div class="form-field">
            <label for="prop-location">위치</label>
            <input id="prop-location" placeholder="예) 서울시 강남구 ○○로 00" />
          </div>
          <div class="form-field">
            <label for="prop-total-tokens">가상 토큰 총 발행량 (개)</label>
            <input id="prop-total-tokens" type="number" placeholder="예) 10000" />
          </div>
          <div class="form-field">
            <label for="prop-owner">기본 소유자 / 관리자 이름</label>
            <input id="prop-owner" placeholder="예) jung / 운영자" />
          </div>
        </div>

        <div class="form-field">
          <label for="prop-memo">간단 메모 (선택)</label>
          <textarea id="prop-memo" placeholder="예) 연습용 가상 부동산입니다. 실제 권리와 무관합니다."></textarea>
        </div>

        <div class="btn-row">
          <button class="primary" type="button" onclick="saveProperty()">부동산 정보 저장</button>
          <button class="secondary" type="button" onclick="clearProperty()">입력값 지우기</button>
        </div>
      </form>

      <div id="prop-summary" class="prop-summary" style="display:none;"></div>

      <div class="info-box small">
        <strong>안내</strong><br />
        · 이 단계에서 저장한 정보는 브라우저(LocalStorage)에만 저장됩니다.<br />
        · 페이지를 새로 열어도 같은 브라우저·같은 PC에서는 다시 불러와집니다.<br />
        · 다른 사람과 “같이 써보는 테스트”라면, 동일한 정보를 입력한 뒤 3단계에서 블록을 추가해 보세요.
      </div>

      <p class="small" style="margin-top:6px;">
        → 부동산 정보 저장 후 <strong>3단계 “블록체인 체험”</strong 탭으로 이동하면, 입력한 정보가 상단에 요약 표시됩니다.
      </p>
    </section>

    <!-- 3단계: 블록체인 체험 -->
    <section id="step3" class="section">
      <h2 class="step-title">3단계. 블록체인 체험</h2>
      <p class="step-sub">거래나 메모를 블록으로 기록해 보면서, “이전 해시”와 “현재 해시”가 어떻게 이어지는지 체험합니다.</p>

      <div id="chain-prop-info" class="info-box small">
        아직 2단계에서 부동산 정보를 저장하지 않았습니다.<br />
        → 먼저 위 탭에서 <strong>2단계</strong>를 선택하고 부동산 정보를 입력·저장해 주세요.
      </div>

      <form id="block-form" onsubmit="return false;" style="margin-top:12px;">
        <div class="form-grid">
          <div class="form-field">
            <label for="blk-title">거래 제목</label>
            <input id="blk-title" placeholder="예) 101동 1001호 보증금 조정" />
          </div>
          <div class="form-field">
            <label for="blk-actor">참여자 / 계정</label>
            <input id="blk-actor" placeholder="예) 임대인 jung / 임차인 kim" />
          </div>
          <div class="form-field">
            <label for="blk-amount">거래 금액 (원)</label>
            <input id="blk-amount" type="number" placeholder="예) 10000000" />
          </div>
        </div>

        <div class="form-field">
          <label for="blk-detail">상세 내용 / 메모</label>
          <textarea id="blk-detail" placeholder="예) 보증금 1,000만 원 인상. 월세 동일 유지. 합의일 2025-11-30."></textarea>
        </div>

        <div class="btn-row">
          <button class="primary" type="button" onclick="addBlock()">새 블록 추가</button>
          <button class="secondary" type="button" onclick="reloadChain()">체인 새로고침</button>
          <button class="danger" type="button" onclick="resetChain()">체인 초기화 (연습 데이터 삭제)</button>
        </div>
      </form>

      <div id="chain-summary" class="chain-summary" style="margin-top:12px;">
        <!-- JS에서 내용 채움 -->
      </div>

      <table>
        <thead>
          <tr>
            <th style="width:32px;">#</th>
            <th style="width:90px;">시간</th>
            <th style="width:120px;">제목</th>
            <th style="width:90px;">참여자</th>
            <th>내용</th>
            <th style="width:90px;">이전 해시</th>
            <th style="width:90px;">현재 해시</th>
          </tr>
        </thead>
        <tbody id="chain-body">
          <!-- JS에서 블록 목록 렌더링 -->
        </tbody>
      </table>

      <p class="small" style="margin-top:8px;">
        · “체인 초기화”를 누르면 이 브라우저에 저장된 연습 데이터가 모두 삭제되고, 제네시스(0번) 블록만 다시 생성됩니다.<br />
        · 실제 서비스로 확장하려면, 이 구조를 기반으로 서버·지갑·권한 관리 등을 추가 설계해야 합니다.
      </p>
    </section>
  </div>
</div>

<script>
  // --- 간단한 상태 관리 ---
  const STORAGE_PROP_KEY = "realEstateProperty_v1";
  const STORAGE_CHAIN_KEY = "realEstateChain_v1";
  let currentProperty = null;
  let chain = [];

  // --- 탭(단계) 이동 ---
  function showStep(stepNum) {
    document.querySelectorAll(".steps-nav button").forEach(btn => {
      btn.classList.toggle("active", btn.dataset.step === String(stepNum));
    });
    document.querySelectorAll(".section").forEach(sec => {
      sec.classList.toggle("active", sec.id === "step" + stepNum);
    });
  }

  document.querySelectorAll(".steps-nav button").forEach(btn => {
    btn.addEventListener("click", () => showStep(btn.dataset.step));
  });

  // --- 단순 해시 함수 (연습용) ---
  function simpleHash(str) {
    let hash = 0x811c9dc5;
    for (let i = 0; i < str.length; i++) {
      hash ^= str.charCodeAt(i);
      hash = (hash * 16777619) >>> 0;
    }
    return hash.toString(16);
  }

  // --- 2단계: 부동산 정보 저장/불러오기 ---
  function saveProperty() {
    const name = document.getElementById("prop-name").value.trim();
    const location = document.getElementById("prop-location").value.trim();
    const totalTokens = document.getElementById("prop-total-tokens").value.trim();
    const owner = document.getElementById("prop-owner").value.trim();
    const memo = document.getElementById("prop-memo").value.trim();

    if (!name) {
      alert("부동산 이름(별칭)을 입력해 주세요.");
      return;
    }

    currentProperty = { name, location, totalTokens, owner, memo };
    localStorage.setItem(STORAGE_PROP_KEY, JSON.stringify(currentProperty));
    renderPropertySummary();
    alert("부동산 정보가 저장되었습니다. (이 브라우저에만 보관)");
  }

  function clearProperty() {
    document.getElementById("property-form").reset();
  }

  function loadProperty() {
    try {
      const saved = localStorage.getItem(STORAGE_PROP_KEY);
      if (!saved) return;
      currentProperty = JSON.parse(saved);
      // 입력칸에도 채워 넣기
      document.getElementById("prop-name").value = currentProperty.name || "";
      document.getElementById("prop-location").value = currentProperty.location || "";
      document.getElementById("prop-total-tokens").value = currentProperty.totalTokens || "";
      document.getElementById("prop-owner").value = currentProperty.owner || "";
      document.getElementById("prop-memo").value = currentProperty.memo || "";
      renderPropertySummary();
    } catch (e) {
      console.error(e);
    }
  }

  function renderPropertySummary() {
    const box = document.getElementById("prop-summary");
    const chainBox = document.getElementById("chain-prop-info");
    if (!currentProperty) {
      box.style.display = "none";
      chainBox.innerHTML = "아직 2단계에서 부동산 정보를 저장하지 않았습니다.<br />→ 먼저 위 탭에서 <strong>2단계</strong>를 선택하고 부동산 정보를 입력·저장해 주세요.";
      return;
    }
    box.style.display = "block";
    box.innerHTML = `
      <strong>저장된 부동산 정보</strong><br />
      · 이름: ${currentProperty.name}<br />
      · 위치: ${currentProperty.location || "-"}<br />
      · 가상 토큰 발행량: ${currentProperty.totalTokens || "-"} 개<br />
      · 소유자/관리자: ${currentProperty.owner || "-"}<br />
      ${currentProperty.memo ? "· 메모: " + currentProperty.memo : ""}
    `;

    chainBox.innerHTML = `
      <strong>현재 체험 중인 부동산</strong><br />
      · ${currentProperty.name}${currentProperty.location ? " (" + currentProperty.location + ")" : ""}<br />
      · 토큰 발행량(가정): ${currentProperty.totalTokens || "-"} 개<br />
      · 관리자: ${currentProperty.owner || "-"}
    `;
  }

  // --- 3단계: 체인 관리 ---
  function initGenesisBlock() {
    const genesis = {
      index: 0,
      timestamp: new Date().toISOString(),
      title: "제네시스 블록",
      actor: "system",
      detail: "체인 시작",
      amount: 0,
      prevHash: "0",
      hash: ""
    };
    genesis.hash = simpleHash(JSON.stringify(genesis));
    chain = [genesis];
  }

  function loadChain() {
    try {
      const saved = localStorage.getItem(STORAGE_CHAIN_KEY);
      if (!saved) {
        initGenesisBlock();
        saveChain();
      } else {
        chain = JSON.parse(saved);
        if (!Array.isArray(chain) || chain.length === 0) {
          initGenesisBlock();
          saveChain();
        }
      }
    } catch (e) {
      console.error(e);
      initGenesisBlock();
      saveChain();
    }
    renderChain();
  }

  function saveChain() {
    localStorage.setItem(STORAGE_CHAIN_KEY, JSON.stringify(chain));
  }

  function reloadChain() {
    loadChain();
    alert("체인을 다시 불러왔습니다.");
  }

  function resetChain() {
    if (!confirm("정말로 체인을 초기화할까요? (연습 데이터가 모두 삭제됩니다)")) return;
    initGenesisBlock();
    saveChain();
    renderChain();
    alert("체인이 초기화되었습니다. (제네시스 블록만 남음)");
  }

  function shortenHash(h) {
    if (!h) return "";
    return h.slice(0, 6) + "…" + h.slice(-4);
  }

  function renderChain() {
    const tbody = document.getElementById("chain-body");
    tbody.innerHTML = "";
    chain.forEach(b => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${b.index}</td>
        <td class="small">${b.timestamp.slice(0, 16).replace("T", " ")}</td>
        <td>${b.title || ""}</td>
        <td>${b.actor || ""}</td>
        <td class="small">${b.detail || ""}</td>
        <td class="hash">${shortenHash(b.prevHash)}</td>
        <td class="hash">${shortenHash(b.hash)}${b.index === chain.length - 1 ? "<span class='pill'>HEAD</span>" : ""}</td>
      `;
      tbody.appendChild(tr);
    });

    const summaryEl = document.getElementById("chain-summary");
    summaryEl.innerHTML = `
      <strong>블록 개수:</strong> ${chain.length} 개
      <span class="tag">제네시스(0번) 포함</span>
      ${currentProperty ? `<span class="tag">부동산: ${currentProperty.name}</span>` : ""}
    `;
  }

  function addBlock() {
    const title = document.getElementById("blk-title").value.trim();
    const actor = document.getElementById("blk-actor").value.trim();
    const amount = document.getElementById("blk-amount").value.trim();
    const detail = document.getElementById("blk-detail").value.trim();

    if (!title && !detail) {
      alert("거래 제목이나 상세 내용을 적어 주세요.");
      return;
    }

    const last = chain[chain.length - 1];
    const blk = {
      index: last.index + 1,
      timestamp: new Date().toISOString(),
      title,
      actor,
      detail,
      amount: amount ? Number(amount) : 0,
      prevHash: last.hash,
      hash: ""
    };
    blk.hash = simpleHash(JSON.stringify(blk));
    chain.push(blk);
    saveChain();
    renderChain();

    // 입력칸 비우기
    document.getElementById("blk-title").value = "";
    document.getElementById("blk-actor").value = "";
    document.getElementById("blk-amount").value = "";
    document.getElementById("blk-detail").value = "";

    alert("새 블록이 추가되었습니다.");
  }

  // --- 초기 로딩 ---
  window.addEventListener("DOMContentLoaded", () => {
    loadProperty();
    loadChain();
  });
</script>
</body>
</html>
